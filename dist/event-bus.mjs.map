{"version":3,"file":"event-bus.mjs","sources":["../build/event-bus.mjs"],"sourcesContent":["class EventBus {\n    constructor() {\n        if (globalThis.__ficusjs__ && globalThis.__ficusjs__.eventBus) {\n            return globalThis.__ficusjs__.eventBus;\n        }\n        this.subscribers = {};\n        globalThis.__ficusjs__ = globalThis.__ficusjs__ || {};\n        globalThis.__ficusjs__.eventBus = globalThis.__ficusjs__.eventBus || this;\n    }\n    /**\n     * Return a list of subscribers for a topic. If no topic is passed, all subscribers are returned\n     * @method\n     * @param topic\n     * @returns {Map|object} A Map of subscribers for a topic or object of all subscribers for all topics\n     */\n    getSubscribers(topic) {\n        return topic ? this.subscribers[topic] : this.subscribers;\n    }\n    /**\n     * Subscribe to a topic\n     *\n     * @method\n     * @param {string} topic\n     * @param {function} callback\n     * @param {object} options\n     * @returns {number} A count of callbacks for this topic\n     */\n    subscribe(topic, callback, options = {}) {\n        const self = this;\n        const opts = Object.assign({ callCount: 0, fireOnce: false }, options);\n        // If there's not already an topic with this name set in our collection\n        // go ahead and create a new one and set it with an empty array, so we don't\n        // have to type check it later down-the-line\n        if (!self.subscribers[topic]) {\n            self.subscribers[topic] = new Map();\n        }\n        // create an unsubscribe function\n        const unsubscribe = () => {\n            const newItems = new Map();\n            self.subscribers[topic].forEach((v, k) => k !== callback && newItems.set(k, v));\n            self.subscribers[topic] = newItems;\n        };\n        // add the callback to the map\n        self.subscribers[topic].set(callback, opts);\n        return unsubscribe;\n    }\n    /**\n     * Publish a message to a topic\n     *\n     * @method\n     * @param {string} topic\n     * @param {object} data\n     * @returns {Map} The subscribers notified by this topic\n     */\n    publish(topic, data) {\n        const self = this;\n        // There's no topic to publish to, so bail out\n        if (!self.subscribers[topic]) {\n            return [];\n        }\n        // Get each subscription and call its callback with the passed data\n        const published = new Map();\n        self.subscribers[topic].forEach((opts, callback) => {\n            if (opts.fireOnce && opts.callCount === 1)\n                return;\n            callback(data);\n            ++opts.callCount;\n            published.set(callback, opts);\n        });\n        return published;\n    }\n}\n/**\n * Function to create an EventBus instance\n * @returns {EventBus}\n */\nexport function createEventBus() {\n    return new EventBus();\n}\n/**\n * Function to get the running EventBus instance\n * @returns {EventBus}\n */\nexport function getEventBus() {\n    return createEventBus();\n}\n"],"names":["EventBus","constructor","globalThis","__ficusjs__","eventBus","this","subscribers","getSubscribers","topic","subscribe","callback","options","self","opts","Object","assign","callCount","fireOnce","Map","set","newItems","forEach","v","k","publish","data","published","createEventBus","getEventBus"],"mappings":"AAAA,MAAMA,EACFC,cACI,GAAIC,WAAWC,aAAeD,WAAWC,YAAYC,SACjD,OAAOF,WAAWC,YAAYC,SAElCC,KAAKC,YAAc,GACnBJ,WAAWC,YAAcD,WAAWC,aAAe,CAAA,EACnDD,WAAWC,YAAYC,SAAWF,WAAWC,YAAYC,UAAYC,IACxE,CAODE,eAAeC,GACX,OAAOA,EAAQH,KAAKC,YAAYE,GAASH,KAAKC,WACjD,CAUDG,UAAUD,EAAOE,EAAUC,EAAU,CAAA,GACjC,MAAMC,EAAOP,KACPQ,EAAOC,OAAOC,OAAO,CAAEC,UAAW,EAAGC,UAAU,GAASN,GAIzDC,EAAKN,YAAYE,KAClBI,EAAKN,YAAYE,GAAS,IAAIU,KAUlC,OADAN,EAAKN,YAAYE,GAAOW,IAAIT,EAAUG,GANlB,KAChB,MAAMO,EAAW,IAAIF,IACrBN,EAAKN,YAAYE,GAAOa,SAAQ,CAACC,EAAGC,IAAMA,IAAMb,GAAYU,EAASD,IAAII,EAAGD,KAC5EV,EAAKN,YAAYE,GAASY,CAAQ,CAKzC,CASDI,QAAQhB,EAAOiB,GAGX,IAFapB,KAEHC,YAAYE,GAClB,MAAO,GAGX,MAAMkB,EAAY,IAAIR,IAQtB,OAdab,KAORC,YAAYE,GAAOa,SAAQ,CAACR,EAAMH,KAC/BG,EAAKI,UAA+B,IAAnBJ,EAAKG,YAE1BN,EAASe,KACPZ,EAAKG,UACPU,EAAUP,IAAIT,EAAUG,GAAK,IAE1Ba,CACV,EAME,SAASC,iBACZ,OAAO,IAAI3B,CACf,CAKO,SAAS4B,cACZ,OAAOD,gBACX"}