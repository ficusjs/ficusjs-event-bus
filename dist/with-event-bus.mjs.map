{"version":3,"file":"with-event-bus.mjs","sources":["../build/with-event-bus.mjs"],"sourcesContent":["// TODO: I was not able to set the options' type to CustomElementOptions, not sure why.\n// Then in with-event-bus.d.ts the withEventBus function accepts two generics, and only one is passed to CustomElementOptions\n// but if I try to do the same, typescript complains because CustomElementOptions needs to have two generics\nexport function withEventBus(eventBus, options) {\n    return Object.assign(Object.assign({}, options), { created() {\n            this.setEventBus(eventBus);\n            if (options.created)\n                options.created.call(this);\n        },\n        mounted() {\n            this._subscribeToEventBus();\n            if (options.mounted)\n                options.mounted.call(this);\n        },\n        updated() {\n            this._subscribeToEventBus();\n            if (options.updated)\n                options.updated.call(this);\n        },\n        removed() {\n            this._unsubscribeFromEventBus();\n            if (options.removed)\n                options.removed.call(this);\n        },\n        setEventBus(eventBus) {\n            const self = this;\n            self._eventBus = eventBus;\n            self._eventSubscriptions = {};\n            self.eventBus = {\n                subscribe(event, callback, options) {\n                    self._eventSubscriptions[event] = { unsubscribe: self._eventBus.subscribe(event, callback, options), callback, options };\n                    return function () {\n                        const { unsubscribe } = self._eventSubscriptions[event];\n                        unsubscribe && unsubscribe();\n                        self._eventSubscriptions[event].unsubscribe = null;\n                    };\n                },\n                publish(event, data = {}) {\n                    // TODO: in the docs I can see that eventBus.publish() returns a map of subscribers, but in this case\n                    // it returns void, should we add a return statement in this function as well?\n                    self._eventBus.publish(event, data);\n                },\n                getSubscribers(topic) {\n                    return self._eventBus.getSubscribers(topic);\n                }\n            };\n        },\n        _subscribeToEventBus() {\n            for (const k in this._eventSubscriptions) {\n                const { unsubscribe, callback, options } = this._eventSubscriptions[k];\n                if (!unsubscribe) {\n                    this._eventSubscriptions[k].unsubscribe = this._eventBus.subscribe(k, callback, options);\n                }\n            }\n        },\n        _unsubscribeFromEventBus() {\n            for (const k in this._eventSubscriptions) {\n                const { unsubscribe } = this._eventSubscriptions[k];\n                unsubscribe && unsubscribe();\n                this._eventSubscriptions[k].unsubscribe = null;\n            }\n        } });\n}\n"],"names":["withEventBus","eventBus","options","Object","assign","created","this","setEventBus","call","mounted","_subscribeToEventBus","updated","removed","_unsubscribeFromEventBus","self","_eventBus","_eventSubscriptions","subscribe","event","callback","unsubscribe","publish","data","getSubscribers","topic","k"],"mappings":"AAGO,SAASA,aAAaC,EAAUC,GACnC,OAAOC,OAAOC,OAAOD,OAAOC,OAAO,CAAA,EAAIF,GAAU,CAAEG,UAC3CC,KAAKC,YAAYN,GACbC,EAAQG,SACRH,EAAQG,QAAQG,KAAKF,KAC5B,EACDG,UACIH,KAAKI,uBACDR,EAAQO,SACRP,EAAQO,QAAQD,KAAKF,KAC5B,EACDK,UACIL,KAAKI,uBACDR,EAAQS,SACRT,EAAQS,QAAQH,KAAKF,KAC5B,EACDM,UACIN,KAAKO,2BACDX,EAAQU,SACRV,EAAQU,QAAQJ,KAAKF,KAC5B,EACDC,YAAYN,GACR,MAAMa,EAAOR,KACbQ,EAAKC,UAAYd,EACjBa,EAAKE,oBAAsB,GAC3BF,EAAKb,SAAW,CACZgB,UAAS,CAACC,EAAOC,EAAUjB,KACvBY,EAAKE,oBAAoBE,GAAS,CAAEE,YAAaN,EAAKC,UAAUE,UAAUC,EAAOC,EAAUjB,GAAUiB,WAAUjB,WACxG,WACH,MAAMkB,YAAEA,GAAgBN,EAAKE,oBAAoBE,GACjDE,GAAeA,IACfN,EAAKE,oBAAoBE,GAAOE,YAAc,IACtE,GAEgBC,QAAQH,EAAOI,EAAO,IAGlBR,EAAKC,UAAUM,QAAQH,EAAOI,EACjC,EACDC,eAAeC,GACJV,EAAKC,UAAUQ,eAAeC,GAGhD,EACDd,uBACI,IAAK,MAAMe,KAAKnB,KAAKU,oBAAqB,CACtC,MAAMI,YAAEA,EAAWD,SAAEA,EAAQjB,QAAEA,GAAYI,KAAKU,oBAAoBS,GAC/DL,IACDd,KAAKU,oBAAoBS,GAAGL,YAAcd,KAAKS,UAAUE,UAAUQ,EAAGN,EAAUjB,GAEvF,CACJ,EACDW,2BACI,IAAK,MAAMY,KAAKnB,KAAKU,oBAAqB,CACtC,MAAMI,YAAEA,GAAgBd,KAAKU,oBAAoBS,GACjDL,GAAeA,IACfd,KAAKU,oBAAoBS,GAAGL,YAAc,IAC7C,CACJ,GACT"}